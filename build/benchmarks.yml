# Orchestrates all benchmarks

variables:
  - template: job-variables.yml
  - name: session
    value: $(Build.BuildNumber)
  - name: buildId
    value: $(Build.BuildId)
  - name: buildNumber
    value: $(Build.BuildNumber)
  - name: am
    value: $[lt(format('{0:HH}', pipeline.startTime), 12)]
  - name: pm
    value: $[ge(format('{0:HH}', pipeline.startTime), 12)]

jobs:

# GROUP 1

- job: Trends_Database_Intel_Linux
  displayName: Trends Database Intel Linux
  pool: server
  timeoutInMinutes: 120
  dependsOn: []
  condition: succeededOrFailed()
  steps:
  - template: trend-database-scenarios.yml
    parameters:
      connection: ASP.NET Benchmarks Queue 1
      arguments: "$(ciProfile) --profile intel-lin-app --profile intel-load-load --profile intel-db-db"

- job: Trends_Intel_Windows
  displayName: Trends Intel Windows
  pool: server
  timeoutInMinutes: 120
  dependsOn: []
  condition: succeededOrFailed()
  steps:
  - template: trend-scenarios.yml
    parameters:
      connection: ASP.NET Benchmarks Queue 2
      arguments: "$(ciProfile) --profile intel-win-app --profile intel-load2-load"

- job: Trends_Database_Arm_Linux
  displayName: Trends Database Arm Linux
  pool: server
  timeoutInMinutes: 120
  dependsOn: []
  condition: succeededOrFailed()
  steps:
  - template: trend-database-scenarios.yml
    parameters:
      connection: ASP.NET Benchmarks Queue 3
      arguments: "$(ciProfile) --profile arm-lin-28-app --profile amd-lin-load --profile amd-lin2-db"

# GROUP 2

- job: Trends_Database_Intel_Windows
  displayName: Trends Database Intel Windows
  pool: server
  timeoutInMinutes: 120
  dependsOn: ["Trends_Database_Intel_Linux", "Trends_Intel_Windows", "Trends_Database_Arm_Linux"]
  condition: succeededOrFailed()
  steps:
  - template: trend-database-scenarios.yml
    parameters:
      connection: ASP.NET Benchmarks Queue 1
      arguments: "$(ciProfile) --profile intel-win-app --profile intel-load-load --profile intel-db-db"

- job: Trends_Intel_Linux
  displayName: Trends Intel Linux
  pool: server
  timeoutInMinutes: 120
  dependsOn: ["Trends_Database_Intel_Linux", "Trends_Intel_Windows", "Trends_Database_Arm_Linux"]
  condition: succeededOrFailed()
  steps:
  - template: trend-scenarios.yml
    parameters:
      connection: ASP.NET Benchmarks Queue 2
      arguments: "$(ciProfile) --profile intel-lin-app --profile intel-load2-load"

- job: Trends_Database_Arm_Windows
  displayName: Trends Database Arm Windows
  pool: server
  timeoutInMinutes: 120
  dependsOn: ["Trends_Database_Intel_Linux", "Trends_Intel_Windows", "Trends_Database_Arm_Linux"]
  condition: succeededOrFailed()
  steps:
  - template: trend-database-scenarios.yml
    parameters:
      connection: ASP.NET Benchmarks Queue 3
      arguments: "$(ciProfile) --profile arm-win-28-app --profile amd-lin-load --profile amd-lin2-db"

# GROUP 3

- job: Trends_Database_Amd_Linux
  displayName: Trends Database Amd Linux
  pool: server
  timeoutInMinutes: 120
  dependsOn: ["Trends_Database_Intel_windows", "Trends_Intel_Linux", "Trends_Database_Arm_Windows"]
  condition: succeededOrFailed()
  steps:
  - template: trend-database-scenarios.yml
    parameters:
      connection: ASP.NET Benchmarks Queue 1
      arguments: "$(ciProfile) --profile amd-lin-app --profile intel-load-load --profile intel-db-db"

- job: Trends_Arm_Linux
  displayName: Trends Intel Linux
  pool: server
  timeoutInMinutes: 120
  dependsOn: ["Trends_Database_Intel_windows", "Trends_Intel_Linux", "Trends_Database_Arm_Windows"]
  condition: succeededOrFailed()
  steps:
  - template: trend-scenarios.yml
    parameters:
      connection: ASP.NET Benchmarks Queue 2
      arguments: "$(ciProfile) --profile arm-lin-28-app --profile intel-load2-load"

- job: Trends_Arm_Windows
  displayName: Trends Arm Windows
  pool: server
  timeoutInMinutes: 120
  dependsOn: ["Trends_Database_Intel_windows", "Trends_Intel_Linux", "Trends_Database_Arm_Windows"]
  condition: succeededOrFailed()
  steps:
  - template: trend-scenarios.yml
    parameters:
      connection: ASP.NET Benchmarks Queue 3
      arguments: "$(ciProfile) --profile arm-win-28app --profile intel-lin-load"

# GROUP 4

- job: Trends_Amd_Linux
  displayName: Trends Amd Linux
  pool: server
  timeoutInMinutes: 120
  dependsOn: ["Trends_Database_Amd_Linux", "Trends_Arm_Linux", "Trends_Arm_Windows"]
  condition: succeededOrFailed()
  steps:
  - template: trend-scenarios.yml
    parameters:
      connection: ASP.NET Benchmarks Queue 1
      arguments: "$(ciProfile) --profile amd-lin-app --profile intel-load2-load"

- job: Containers_Intel_Linux
  displayName: Containers Intel Linux
  pool: server
  timeoutInMinutes: 120
  dependsOn: ["Trends_Database_Amd_Linux", "Trends_Arm_Linux", "Trends_Arm_Windows"]
  condition: succeededOrFailed()
  steps:
  - template: containers-scenarios.yml
    parameters:
      connection: ASP.NET Benchmarks Queue 2
      arguments: "$(ciProfile) --profile arm-lin-28-app --profile intel-load2-load"

- job: EF_Core_Intel_Windows
  displayName: EF Core Intel Windows
  pool: server
  timeoutInMinutes: 120
  dependsOn: ["Trends_Database_Amd_Linux", "Trends_Arm_Linux", "Trends_Arm_Windows"]
  condition: succeededOrFailed()
  steps:
  - template: efcore-scenarios.yml
    parameters:
      connection: ASP.NET Benchmarks Queue 3
      arguments: "$(ciProfile) --profile intel-win-app"
